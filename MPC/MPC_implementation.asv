%% State space model 
Ap = 0.8;
Bp = 0.1;
Cp = 1;
Nc = 4;
Np = 10;
rw = 0;
%% Finding optimal solution for delta U
% Using function for calculating following matrices:
% Phi_Phi,Phi_F,Phi_R,A_e, B_e,C_e

[Phi_Phi,Phi_F,Phi_R,A_e, B_e,C_e]=mpcgain(Ap,Bp,Cp,Nc,Np,1);

% ΔU = inv((Φ'Φ+ R))(Φ'*Rs− Φ'*F*x(ki)) 
[~ , n_in] = size(Bp);
R = rw*eye(Nc*n_in);
x_current = [0.1 ; 0.2];

deltau = (Phi_Phi+R)\(Phi_R-Phi_F*x_current);